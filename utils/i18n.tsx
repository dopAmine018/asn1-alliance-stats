
import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import { Language } from '../types';

type TranslationKey = 
  | 'nav.public' | 'nav.admin' | 'nav.logout' | 'nav.home'
  | 'landing.welcome' | 'landing.subtitle' | 'landing.action.update' | 'landing.action.update.desc' | 'landing.action.view' | 'landing.action.view.desc'
  | 'form.title' | 'form.success' | 'form.submit' | 'form.saving' | 'form.optional' | 'form.required_error'
  | 'section.identity' | 'section.identity.desc' | 'section.power' | 'section.power.desc' 
  | 'section.tech' | 'section.tech.desc'
  | 'section.infrastructure' | 'section.infrastructure.desc'
  | 'section.t10' | 'section.t10.desc'
  | 'label.language' | 'label.name' | 'label.power' | 'label.squad2' | 'label.squad3' | 'label.squad4' | 'label.totalHeroPower'
  | 'placeholder.server_rank' | 'hint.server_rank'
  | 'stat.hero' | 'stat.duel' | 'stat.units'
  | 't10.title' | 't10.morale' | 't10.protection' | 't10.hp' | 't10.atk' | 't10.def'
  | 'calc.title' | 'calc.gold' | 'calc.valor' | 'calc.food_iron' | 'calc.remaining'
  | 'level.tech' | 'level.barracks' | 'level.tank' | 'level.air' | 'level.missile'
  | 'card.hero_pwr' | 'card.tech_short' | 'card.barr_short' | 'card.tank_short' | 'card.air_short' | 'card.misl_short'
  | 'viewer.leaderboard' | 'viewer.search' | 'viewer.sort' | 'viewer.showing' | 'viewer.no_results' | 'viewer.updated' | 'viewer.export' | 'viewer.back'
  | 'sort.newest' | 'sort.oldest' | 'sort.highest_power' | 'sort.lowest_power'
  | 'sort.highest_total_hero_power' | 'sort.lowest_total_hero_power'
  | 'admin.login.title' | 'admin.login.btn' | 'admin.dashboard' | 'admin.password' | 'admin.db' | 'admin.vs' | 'admin.filter'
  | 'admin.active_only' | 'admin.active_only' | 'admin.all_records' | 'admin.status' | 'admin.identity' | 'admin.control' | 'admin.terminate' | 'admin.save' | 'admin.cancel' | 'admin.edit' | 'admin.del'
  | 'vs.select' | 'vs.create_btn' | 'vs.extract' | 'vs.modal_title' | 'vs.modal_placeholder' | 'vs.abort' | 'vs.launch' 
  | 'vs.agent' | 'vs.sum' | 'vs.add_agent_ph' | 'vs.inject' | 'vs.awaiting'
  | 'day.mon' | 'day.tue' | 'day.wed' | 'day.thu' | 'day.fri' | 'day.sat'
  | 'credit.architect';

const translations: Record<Language, Record<TranslationKey, string>> = {
  english: {
    'nav.public': 'Command',
    'nav.admin': 'Admin Link',
    'nav.logout': 'Logout',
    'nav.home': 'Return to Base',
    'landing.welcome': 'ASN1 Command Center',
    'landing.subtitle': 'Select your directive commander.',
    'landing.action.update': 'Update Profile',
    'landing.action.update.desc': 'Submit latest combat stats and facility levels.',
    'landing.action.view': 'View Database',
    'landing.action.view.desc': 'Access alliance leaderboard and intel.',
    'form.title': 'Submit / Update Stats',
    'form.success': 'Stats saved successfully!',
    'form.submit': 'Save Player Stats',
    'form.saving': 'Saving...',
    'form.optional': 'Optional',
    'form.required_error': 'Please fill all required fields.',
    'section.identity': '01 // Identity Verification',
    'section.identity.desc': 'Verify commander credentials.',
    'section.power': '02 // POWER',
    'section.power.desc': 'Smart Format: 24.5 = 24.5M',
    'section.tech': '03 // TECHNOLOGIE',
    'section.tech.desc': 'Research & Advanced Buffs',
    'section.infrastructure': '04 // BUILDINGS',
    'section.infrastructure.desc': 'Base Facility Levels',
    'section.t10': '05 // Tier 10 Analysis',
    'section.t10.desc': 'Advanced Buffs',
    'label.language': 'Language',
    'label.name': 'In-game name',
    'label.power': 'First Squad Power',
    'label.squad2': 'Squad 2',
    'label.squad3': 'Squad 3',
    'label.squad4': 'Squad 4',
    'label.totalHeroPower': 'Total Hero Power',
    'placeholder.server_rank': 'Server Rank',
    'hint.server_rank': 'ℹ️ Find this in Server Rankings',
    'stat.hero': 'Hero %',
    'stat.duel': "VS 'Duel' %",
    'stat.units': 'Units %',
    't10.title': 'Tier 10 Bonuses',
    't10.morale': 'Morale',
    't10.protection': 'Protection',
    't10.hp': 'HP Boost',
    't10.atk': 'Attack Boost',
    't10.def': 'Defense Boost',
    'calc.title': 'T10 Resource Projector',
    'calc.gold': 'Gold Needed',
    'calc.valor': 'Valor Needed',
    'calc.food_iron': 'Food/Iron Needed',
    'calc.remaining': 'Remaining to T10 Unlock',
    'level.tech': 'Tech Center',
    'level.barracks': 'Barracks',
    'level.tank': 'Tank Center',
    'level.air': 'Air Center',
    'level.missile': 'Missile Center',
    'card.hero_pwr': 'HERO PWR',
    'card.tech_short': 'Tech',
    'card.barr_short': 'Barr',
    'card.tank_short': 'Tank',
    'card.air_short': 'Air',
    'card.misl_short': 'Misl',
    'viewer.leaderboard': 'Alliance Leaderboard',
    'viewer.search': 'Search name...',
    'viewer.sort': 'Sort by',
    'viewer.showing': 'active',
    'viewer.no_results': 'No players found.',
    'viewer.updated': 'Updated',
    'viewer.export': 'Export CSV',
    'viewer.back': 'Back',
    'sort.newest': 'Newest',
    'sort.oldest': 'Oldest',
    'sort.highest_power': 'Highest Power',
    'sort.lowest_power': 'Lowest Power',
    'sort.highest_total_hero_power': 'Highest Hero Power',
    'sort.lowest_total_hero_power': 'Lowest Hero Power',
    'admin.login.title': 'Admin Access',
    'admin.login.btn': 'Unlock Panel',
    'admin.dashboard': 'Admin Dashboard',
    'admin.password': 'Enter Password',
    'admin.db': 'Database',
    'admin.vs': 'VS Duel',
    'admin.filter': 'Filter...',
    'admin.active_only': 'Active Only',
    'admin.all_records': 'All Records',
    'admin.status': 'Status',
    'admin.identity': 'Identity',
    'admin.control': 'Control',
    'admin.terminate': 'Terminate',
    'admin.save': 'Save',
    'admin.cancel': 'Cancel',
    'admin.edit': 'Edit',
    'admin.del': 'Del',
    'vs.select': 'Select Duel',
    'vs.create_btn': '+ Duel',
    'vs.extract': 'Extract Data',
    'vs.modal_title': 'Init VS Duel',
    'vs.modal_placeholder': 'Duel Name',
    'vs.abort': 'Abort',
    'vs.launch': 'Launch',
    'vs.agent': 'Agent',
    'vs.sum': 'Sum',
    'vs.add_agent_ph': 'Add Agent...',
    'vs.inject': 'Inject',
    'vs.awaiting': 'Awaiting Selection...',
    'day.mon': 'Mon',
    'day.tue': 'Tue',
    'day.wed': 'Wed',
    'day.thu': 'Thu',
    'day.fri': 'Fri',
    'day.sat': 'Sat',
    'credit.architect': 'MADE BY AMINE',
  },
  arabic: {
    'nav.public': 'القيادة',
    'nav.admin': 'رابط المشرف',
    'nav.logout': 'خروج',
    'nav.home': 'العودة للقاعدة',
    'landing.welcome': 'مركز قيادة ASN1',
    'landing.subtitle': 'اختر توجيهك أيها القائد.',
    'landing.action.update': 'تحديث الملف',
    'landing.action.update.desc': 'إرسال أحدث إحصائيات القتال ومستويات المباني.',
    'landing.action.view': 'عرض البيانات',
    'landing.action.view.desc': 'الوصول إلى لوحة صدارة التحالف والاستخبارات.',
    'form.title': 'تحديث الإحصائيات',
    'form.success': 'تم الحفظ بنجاح!',
    'form.submit': 'حفظ البيانات',
    'form.saving': 'جاري الحفظ...',
    'form.optional': 'اختياري',
    'form.required_error': 'يرجى ملء الحقول المطلوبة.',
    'section.identity': '01 // التحقق من الهوية',
    'section.identity.desc': 'تأكيد بيانات القائد.',
    'section.power': '02 // الطاقة',
    'section.power.desc': 'تنسيق ذكي: 24.5 = 24.5 مليون',
    'section.tech': '03 // التكنولوجيا',
    'section.tech.desc': 'نسب الأبحاث والمكافآت',
    'section.infrastructure': '04 // المباني',
    'section.infrastructure.desc': 'مستويات مباني القاعدة',
    'section.t10': '05 // تحليل المستوى 10',
    'section.t10.desc': 'تعزيزات متقدمة',
    'label.language': 'اللغة',
    'label.name': 'اسم القائد',
    'label.power': 'قوة الفريق 1',
    'label.squad2': 'الفريق 2',
    'label.squad3': 'الفريق 3',
    'label.squad4': 'الفريق 4',
    'label.totalHeroPower': 'قوة الأبطال',
    'placeholder.server_rank': 'ترتيب السيرفر',
    'hint.server_rank': 'ℹ️ تجدها في تصنيف السيرفر',
    'stat.hero': 'الأبطال %',
    'stat.duel': 'المبارزة %',
    'stat.units': 'الجنود %',
    't10.title': 'مكافآت T10',
    't10.morale': 'جبروت',
    't10.protection': 'حماية',
    't10.hp': 'صحة HP',
    't10.atk': 'هجوم',
    't10.def': 'دفاع',
    'calc.title': 'حاسبة موارد T10',
    'calc.gold': 'الذهب المطلوب',
    'calc.valor': 'ميداليات الشرف المطلوبة',
    'calc.food_iron': 'طعام/حديد مطلوب',
    'calc.remaining': 'المتبقي لفتح T10',
    'level.tech': 'مركز التقنية',
    'level.barracks': 'الثكنة',
    'level.tank': 'مركز الدبابات',
    'level.air': 'مركز الطيران',
    'level.missile': 'مركز الصواريخ',
    'card.hero_pwr': 'قوة الأبطال',
    'card.tech_short': 'تقنية',
    'card.barr_short': 'ثكنة',
    'card.tank_short': 'دبابة',
    'card.air_short': 'طيران',
    'card.misl_short': 'صواريخ',
    'viewer.leaderboard': 'صدارة التحالف',
    'viewer.search': 'بحث...',
    'viewer.sort': 'ترتيب',
    'viewer.showing': 'نشط',
    'viewer.no_results': 'لا توجد نتائج.',
    'viewer.updated': 'تحديث',
    'viewer.export': 'CSV',
    'viewer.back': 'عودة',
    'sort.newest': 'الأحدث',
    'sort.oldest': 'الأقدم',
    'sort.highest_power': 'الأعلى قوة',
    'sort.lowest_power': 'الأقل قوة',
    'sort.highest_total_hero_power': 'أعلى قوة أبطال',
    'sort.lowest_total_hero_power': 'أقل قوة أبطال',
    'admin.login.title': 'دخول المشرف',
    'admin.login.btn': 'دخول',
    'admin.dashboard': 'لوحة المشرف',
    'admin.password': 'كلمة المرور',
    'admin.db': 'قاعدة البيانات',
    'admin.vs': 'تحدي VS',
    'admin.filter': 'تصفية...',
    'admin.active_only': 'النشطين',
    'admin.all_records': 'الكل',
    'admin.status': 'الحالة',
    'admin.identity': 'الهوية',
    'admin.control': 'تحكم',
    'admin.terminate': 'إنهاء',
    'admin.save': 'حفظ',
    'admin.cancel': 'إلغاء',
    'admin.edit': 'تعديل',
    'admin.del': 'حذف',
    'vs.select': 'تحديد',
    'vs.create_btn': '+ تحدي',
    'vs.extract': 'استخراج',
    'vs.modal_title': 'تحدي جديد',
    'vs.modal_placeholder': 'الاسم',
    'vs.abort': 'إلغاء',
    'vs.launch': 'بدء',
    'vs.agent': 'العميل',
    'vs.sum': 'مجموع',
    'vs.add_agent_ph': 'إضافة...',
    'vs.inject': 'إدراج',
    'vs.awaiting': 'في الانتظار...',
    'day.mon': 'إثنين',
    'day.tue': 'ثلاثاء',
    'day.wed': 'أربعاء',
    'day.thu': 'خميس',
    'day.fri': 'جمعة',
    'day.sat': 'سبت',
    'credit.architect': 'صنع بواسطة أمين',
  },
  turkish: {
    'nav.public': 'Komuta',
    'nav.admin': 'Yönetici',
    'nav.logout': 'Çıkış',
    'nav.home': 'Üsse Dön',
    'landing.welcome': 'ASN1 Komuta Merkezi',
    'landing.subtitle': 'Komutan, görevinizi seçin.',
    'landing.action.update': 'Profili Güncelle',
    'landing.action.update.desc': 'Son savaş istatistiklerini ve bina seviyelerini gönder.',
    'landing.action.view': 'Veritabanını Görüntüle',
    'landing.action.view.desc': 'İttifak sıralamasına ve istihbaratına eriş.',
    'form.title': 'İstatistik Güncelle',
    'form.success': 'Başarıyla kaydedildi!',
    'form.submit': 'Kaydet',
    'form.saving': 'Kaydediliyor...',
    'form.optional': 'İsteğe bağlı',
    'form.required_error': 'Gerekli alanları doldurun.',
    'section.identity': '01 // Kimlik Doğrulama',
    'section.identity.desc': 'Komutan bilgilerini onayla.',
    'section.power': '02 // GÜÇ',
    'section.power.desc': 'Akıllı Format: 24.5 = 24.5M',
    'section.tech': '03 // TEKNOLOJİ',
    'section.tech.desc': 'Araştırma ve Gelişmiş Bonuslar',
    'section.infrastructure': '04 // BİNALAR',
    'section.infrastructure.desc': 'Üs Bina Seviyeleri',
    'section.t10': '05 // Seviye 10 Analizi',
    'section.t10.desc': 'Gelişmiş Güçlendirmeler',
    'label.language': 'Dil',
    'label.name': 'Oyun ismi',
    'label.power': '1. Takım Gücü',
    'label.squad2': '2. Takım',
    'label.squad3': '3. Takım',
    'label.squad4': '4. Takım',
    'label.totalHeroPower': 'Kahraman Gücü',
    'placeholder.server_rank': 'Sunucu Sırası',
    'hint.server_rank': 'ℹ️ Sunucu Sıralamasından al',
    'stat.hero': 'Kahraman %',
    'stat.duel': 'Düello %',
    'stat.units': 'Birim %',
    't10.title': 'T10 Bonusları',
    't10.morale': 'Moral',
    't10.protection': 'Koruma',
    't10.hp': 'Can',
    't10.atk': 'Saldırı',
    't10.def': 'Savunma',
    'calc.title': 'T10 Kaynak Hesaplayıcı',
    'calc.gold': 'Gerekli Altın',
    'calc.valor': 'Gerekli Cesaret',
    'calc.food_iron': 'Yiyecek/Demir',
    'calc.remaining': 'T10 Kilidine Kalan',
    'level.tech': 'Teknoloji',
    'level.barracks': 'Kışla',
    'level.tank': 'Tank',
    'level.air': 'Hava',
    'level.missile': 'Füze',
    'card.hero_pwr': 'KAHRAMAN',
    'card.tech_short': 'Tekn',
    'card.barr_short': 'Kışla',
    'card.tank_short': 'Tank',
    'card.air_short': 'Hava',
    'card.misl_short': 'Füze',
    'viewer.leaderboard': 'İttifak Sıralaması',
    'viewer.search': 'Ara...',
    'viewer.sort': 'Sırala',
    'viewer.showing': 'aktif',
    'viewer.no_results': 'Sonuç yok.',
    'viewer.updated': 'Güncel',
    'viewer.export': 'CSV',
    'viewer.back': 'Geri',
    'sort.newest': 'En Yeni',
    'sort.oldest': 'En Eski',
    'sort.highest_power': 'En Yüksek Güç',
    'sort.lowest_power': 'En Düşük Güç',
    'sort.highest_total_hero_power': 'Yüksek Kahraman Gücü',
    'sort.lowest_total_hero_power': 'Düşük Kahraman Gücü',
    'admin.login.title': 'Yönetici',
    'admin.login.btn': 'Giriş',
    'admin.dashboard': 'Panel',
    'admin.password': 'Şifre',
    'admin.db': 'Veritabanı',
    'admin.vs': 'VS Düello',
    'admin.filter': 'Filtre...',
    'admin.active_only': 'Aktif',
    'admin.all_records': 'Tümü',
    'admin.status': 'Durum',
    'admin.identity': 'Kimlik',
    'admin.control': 'Kontrol',
    'admin.terminate': 'Sonlandır',
    'admin.save': 'Kaydet',
    'admin.cancel': 'İptal',
    'admin.edit': 'Düzenle',
    'admin.del': 'Sil',
    'vs.select': 'Seç',
    'vs.create_btn': '+ Düello',
    'vs.extract': 'Çıkar',
    'vs.modal_title': 'Yeni VS',
    'vs.modal_placeholder': 'İsim',
    'vs.abort': 'İptal',
    'vs.launch': 'Başlat',
    'vs.agent': 'Ajan',
    'vs.sum': 'Top',
    'vs.add_agent_ph': 'Ekle...',
    'vs.inject': 'Ekle',
    'vs.awaiting': 'Bekleniyor...',
    'day.mon': 'Pzt',
    'day.tue': 'Sal',
    'day.wed': 'Çar',
    'day.thu': 'Per',
    'day.fri': 'Cum',
    'day.sat': 'Cmt',
    'credit.architect': 'YAPIMCI: AMINE',
  },
  indonesian: {
    'nav.public': 'Komando',
    'nav.admin': 'Link Admin',
    'nav.logout': 'Keluar',
    'nav.home': 'Kembali ke Markas',
    'landing.welcome': 'Pusat Komando ASN1',
    'landing.subtitle': 'Pilih arahan Anda, komandan.',
    'landing.action.update': 'Perbarui Profil',
    'landing.action.update.desc': 'Kirim statistik tempur dan level fasilitas terbaru.',
    'landing.action.view': 'Lihat Database',
    'landing.action.view.desc': 'Akses papan peringkat dan intelijen aliansi.',
    'form.title': 'Perbarui Statistik',
    'form.success': 'Berhasil disimpan!',
    'form.submit': 'Simpan',
    'form.saving': 'Menyimpan...',
    'form.optional': 'Opsional',
    'form.required_error': 'Isi kolom wajib.',
    'section.identity': '01 // Verifikasi Identitas',
    'section.identity.desc': 'Verifikasi kredensial.',
    'section.power': '02 // KEKUATAN',
    'section.power.desc': 'Format Cerdas: 24.5 = 24.5M',
    'section.tech': '03 // TEKNOLOGI',
    'section.tech.desc': 'Riset & Bonus Tingkat Lanjut',
    'section.infrastructure': '04 // BANGUNAN',
    'section.infrastructure.desc': 'Level Bangunan Markas',
    'section.t10': '05 // Analisis Tier 10',
    'section.t10.desc': 'Buff Tingkat Lanjut',
    'label.language': 'Bahasa',
    'label.name': 'Nama Game',
    'label.power': 'Kekuatan Pasukan 1',
    'label.squad2': 'Pasukan 2',
    'label.squad3': 'Pasukan 3',
    'label.squad4': 'Pasukan 4',
    'label.totalHeroPower': 'Kekuatan Hero',
    'placeholder.server_rank': 'Peringkat Server',
    'hint.server_rank': 'ℹ️ Dapatkan dari Peringkat Server',
    'stat.hero': 'Hero %',
    'stat.duel': 'Duel %',
    'stat.units': 'Unit %',
    't10.title': 'Bonus T10',
    't10.morale': 'Moral',
    't10.protection': 'Proteksi',
    't10.hp': 'HP',
    't10.atk': 'Serangan',
    't10.def': 'Pertahanan',
    'calc.title': 'Kalkulator Sumber Daya T10',
    'calc.gold': 'Emas Dibutuhkan',
    'calc.valor': 'Valor Dibutuhkan',
    'calc.food_iron': 'Makanan/Besi',
    'calc.remaining': 'Sisa Menuju T10',
    'level.tech': 'Teknologi',
    'level.barracks': 'Barak',
    'level.tank': 'Tank',
    'level.air': 'Udara',
    'level.missile': 'Rudal',
    'card.hero_pwr': 'HERO',
    'card.tech_short': 'Tek',
    'card.barr_short': 'Bar',
    'card.tank_short': 'Tank',
    'card.air_short': 'Udara',
    'card.misl_short': 'Rudal',
    'viewer.leaderboard': 'Papan Peringkat',
    'viewer.search': 'Cari...',
    'viewer.sort': 'Urutkan',
    'viewer.showing': 'aktif',
    'viewer.no_results': 'Tidak ada.',
    'viewer.updated': 'Diperbarui',
    'viewer.export': 'CSV',
    'viewer.back': 'Kembali',
    'sort.newest': 'Terbaru',
    'sort.oldest': 'Terlama',
    'sort.highest_power': 'Tertinggi',
    'sort.lowest_power': 'Terendah',
    'sort.highest_total_hero_power': 'Hero Tertinggi',
    'sort.lowest_total_hero_power': 'Hero Terendah',
    'admin.login.title': 'Admin',
    'admin.login.btn': 'Masuk',
    'admin.dashboard': 'Dasbor',
    'admin.password': 'Sandi',
    'admin.db': 'Database',
    'admin.vs': 'VS Duel',
    'admin.filter': 'Filter...',
    'admin.active_only': 'Aktif',
    'admin.all_records': 'Semua',
    'admin.status': 'Status',
    'admin.identity': 'Identitas',
    'admin.control': 'Kontrol',
    'admin.terminate': 'Akhiri',
    'admin.save': 'Simpan',
    'admin.cancel': 'Batal',
    'admin.edit': 'Ubah',
    'admin.del': 'Hapus',
    'vs.select': 'Pilih',
    'vs.create_btn': '+ Duel',
    'vs.extract': 'Ekstrak',
    'vs.modal_title': 'VS Baru',
    'vs.modal_placeholder': 'Nama',
    'vs.abort': 'Batal',
    'vs.launch': 'Mulai',
    'vs.agent': 'Agen',
    'vs.sum': 'Jml',
    'vs.add_agent_ph': 'Tambah...',
    'vs.inject': 'Masuk',
    'vs.awaiting': 'Menunggu...',
    'day.mon': 'Sen',
    'day.tue': 'Sel',
    'day.wed': 'Rab',
    'day.thu': 'Kam',
    'day.fri': 'Jum',
    'day.sat': 'Sab',
    'credit.architect': 'DIBUAT OLEH AMINE',
  }
};

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: TranslationKey) => string;
  dir: 'ltr' | 'rtl';
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const LanguageProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>('english');

  useEffect(() => {
    // Detect Browser Language
    const browserLang = navigator.language.split('-')[0];
    if (browserLang === 'ar') setLanguage('arabic');
    else if (browserLang === 'tr') setLanguage('turkish');
    else if (browserLang === 'id') setLanguage('indonesian');
    else setLanguage('english');
  }, []);

  const t = (key: TranslationKey): string => {
    return translations[language][key] || key;
  };

  const dir = language === 'arabic' ? 'rtl' : 'ltr';

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t, dir }}>
      <div dir={dir} className={language === 'arabic' ? 'font-sans' : ''}>
        {children}
      </div>
    </LanguageContext.Provider>
  );
};

export const useLanguage = () => {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useLanguage must be used within a LanguageProvider');
  }
  return context;
};
